<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Free UK Salary Sacrifice Calculator 2025. Calculate car lease, pension contributions & BiK tax savings. See how much you can save on income tax and National Insurance with salary sacrifice schemes.">
    <meta name="keywords" content="UK salary sacrifice calculator, car lease calculator, BiK tax calculator, pension salary sacrifice, tax savings calculator, take home pay calculator UK, salary sacrifice car scheme, electric car BiK rates 2025">
    <meta name="author" content="UK Tax Calculator">
    <meta property="og:title" content="Free UK Salary Sacrifice Calculator 2025 | Car Lease & Tax Savings">
    <meta property="og:description" content="Calculate your salary sacrifice savings instantly. Car leasing, pension contributions, BiK tax rates for 2025. Free UK tax calculator.">
    <meta property="og:type" content="website">
    <title>Free UK Salary Sacrifice Calculator 2025 | Car Lease, Pension & BiK Tax Savings</title>

    <script async src="https://www.googletagmanager.com/gtag/js?id=G-B0YQPMRS5H"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-B0YQPMRS5H');
    </script>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50, #3498db);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .logo {
            font-size: 3.5rem;
            font-weight: 900;
            margin-bottom: 15px;
            color: white;
            text-shadow: 2px 2px 6px rgba(0,0,0,0.4);
            letter-spacing: -1px;
        }

        .header h1 {
            font-size: 1.8rem;
            margin-bottom: 10px;
            font-weight: 300;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0;
            min-height: 80vh;
        }

        .input-section {
            padding: 40px;
            background: #f8f9fa;
            border-right: 1px solid #e9ecef;
        }

        .results-section {
            padding: 40px;
            background: white;
            display: flex;
            flex-direction: column;
        }

        .info-section {
            width: 100%;
            background: #f8f9fa;
            border-top: 1px solid #e9ecef;
        }

        .form-group {
            margin-bottom: 25px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
            font-size: 0.95rem;
        }

        input[type="number"], select {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: white;
        }

        input[type="number"]:focus, select:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }

        input[type="checkbox"] {
            width: 18px;
            height: 18px;
            accent-color: #3498db;
        }

        .section-title {
            font-size: 1.3rem;
            color: #2c3e50;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #3498db;
        }

        .result-card {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            border-left: 5px solid #3498db;
        }

        .result-main {
            font-size: 2.2rem;
            font-weight: 700;
            color: #27ae60;
            margin-bottom: 10px;
        }

        .result-label {
            font-size: 1rem;
            color: #7f8c8d;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .breakdown {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
        }

        .breakdown-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #e9ecef;
        }

        .breakdown-item:last-child {
            border-bottom: none;
            font-weight: 700;
            font-size: 1.1rem;
        }

        .savings-highlight {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: white;
            border-radius: 15px;
            padding: 25px;
            margin-top: 20px;
            text-align: center;
        }

        .savings-amount {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .car-section {
            background: #e8f4f8;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
        }

        .bik-breakdown {
            background: #f0f8ff;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            border: 1px solid #b3d9ff;
        }

        .share-section {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .share-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
        }

        .share-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.3);
            padding: 12px 24px;
            border-radius: 25px;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .share-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        .tax-info {
            background: #e8f4f8;
            border-left: 4px solid #3498db;
            padding: 15px;
            margin-top: 20px;
            border-radius: 5px;
            font-size: 0.9rem;
        }

        .info-box {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            font-size: 0.9rem;
        }

        .info-box.tax-free-childcare {
            background: #d1ecf1;
            border-color: #bee5eb;
        }

        .two-column {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .warning {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }

        .benefit-breakdown {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
        }

        .benefit-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #e9ecef;
        }

        .benefit-item:last-child {
            border-bottom: none;
            font-weight: 700;
            font-size: 1.1rem;
            color: #27ae60;
        }

        .benefit-item.negative {
            color: #e74c3c;
        }

        /* Custom Message Box */
        .message-box-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease;
        }

        .message-box-overlay.show {
            opacity: 1;
            visibility: visible;
        }

        .message-box-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            text-align: center;
            max-width: 350px;
            width: 90%;
            transform: translateY(-20px);
            transition: transform 0.3s ease;
        }

        .message-box-overlay.show .message-box-content {
            transform: translateY(0);
        }

        .message-box-content h4 {
            margin-bottom: 15px;
            color: #2c3e50;
            font-size: 1.3rem;
        }

        .message-box-content p {
            margin-bottom: 25px;
            color: #555;
            line-height: 1.5;
        }

        .message-box-content button {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            transition: background 0.2s ease;
        }

        .message-box-content button:hover {
            background: #2980b9;
        }

        .info-icon {
            cursor: help;
            font-size: 0.8em;
            vertical-align: middle;
            margin-left: 5px;
            color: #3498db;
        }


        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .input-section {
                border-right: none;
                border-bottom: 1px solid #e9ecef;
                padding: 20px;
            }

            .results-section {
                padding: 20px;
            }
            
            .logo {
                font-size: 2.5rem;
            }
            
            .header h1 {
                font-size: 1.5rem;
            }
            
            .container {
                margin: 10px;
            }

            .two-column {
                grid-template-columns: 1fr;
                gap: 10px;
            }

            .info-section > div > div {
                grid-template-columns: 1fr !important;
            }

            .form-group {
                margin-bottom: 20px;
            }

            .form-group label {
                font-size: 0.9rem;
            }

            .form-group input, .form-group select {
                padding: 10px 12px;
                font-size: 0.95rem;
            }

            .form-group small {
                font-size: 0.8rem;
                line-height: 1.3;
            }

            .breakdown {
                padding: 15px;
            }

            .breakdown-item {
                padding: 6px 0;
                font-size: 0.9rem;
            }

            .result-card {
                padding: 20px;
                margin-bottom: 15px;
            }

            .result-main {
                font-size: 1.8rem;
            }

            .section-title {
                font-size: 1.2rem;
                margin-bottom: 15px;
            }

            .savings-highlight {
                padding: 20px;
                margin-top: 15px;
            }

            .savings-amount {
                font-size: 1.7rem;
            }

            .benefit-breakdown {
                padding: 15px;
                margin-top: 15px;
            }

            .benefit-item {
                padding: 6px 0;
                font-size: 0.9rem;
            }

            /* Mobile radio button fixes */
            .form-group > div {
                flex-wrap: wrap;
                gap: 8px;
                margin-bottom: 8px;
            }

            .form-group > div label {
                font-size: 0.85rem;
                margin: 0;
                margin-left: 4px;
            }

            .form-group input[type="radio"] {
                width: 16px;
                height: 16px;
            }

            /* Scenario comparison mobile fix */
            .scenario-comparison {
                grid-template-columns: 1fr !important;
                gap: 15px !important;
            }

            .scenario-box {
                margin-bottom: 15px;
            }

            /* Mobile Fixed Bottom Summary */
            .mobile-summary-fixed {
                display: flex; /* Show only on mobile screens */
            }

            /* Adjust body padding to prevent overlap with fixed footer */
            body {
                padding-bottom: 70px; /* Adjust based on the height of your fixed summary */
            }
        }

        /* Mobile Fixed Bottom Summary */
        .mobile-summary-fixed {
            display: none; /* Hidden by default for desktop */
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 20px;
            box-shadow: 0 -4px 20px rgba(0,0,0,0.15);
            z-index: 1000;
            border-top: 1px solid rgba(255,255,255,0.2);
        }

        .mobile-summary-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 400px; /* Constrain width for better readability on wider mobiles */
            margin: 0 auto;
        }

        .mobile-summary-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            flex: 1; /* Distribute space evenly */
        }

        .mobile-summary-label {
            font-size: 0.75rem;
            opacity: 0.9;
            margin-bottom: 2px;
        }

        .mobile-summary-value {
            font-size: 1.1rem;
            font-weight: 700;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        }

        .mobile-summary-divider {
            width: 1px;
            height: 30px;
            background: rgba(255,255,255,0.3);
            margin: 0 15px; /* Space out the items */
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo">UK Tax Cal</div>
            <h1>Free UK Salary Sacrifice Calculator 2025</h1>
            <p>Calculate car lease, pension & BiK tax savings instantly. Discover how much you can save with salary sacrifice schemes</p>
        </div>

        <div class="main-content">
            <div class="input-section">
                <h2 class="section-title">Your Details</h2>
                
                <div class="form-group">
                    <label for="grossSalary">Annual Gross Salary (¬£)</label>
                    <input type="number" id="grossSalary" value="130000" min="0" step="1000">
                </div>

                <div class="form-group">
                    <label for="pensionContrib">Personal Pension Contribution</label>
                    <div style="display: flex; gap: 10px; align-items: center; margin-bottom: 10px;">
                        <input type="radio" id="pensionFixed" name="pensionType" value="fixed" checked>
                        <label for="pensionFixed" style="margin: 0;">Fixed Amount (¬£)</label>
                        <input type="radio" id="pensionPercent" name="pensionType" value="percent">
                        <label for="pensionPercent" style="margin: 0;">Percentage (%)</label>
                    </div>
                    <input type="number" id="pensionContrib" value="0" min="0" step="100">
                    <input type="number" id="pensionContribPercent" value="0" min="0" max="100" step="0.1" style="display: none;">
                    <small style="color: #666;">Your contribution - reduces taxable income</small>
                </div>

                <div class="form-group">
                    <label for="employerPension">Employer Pension Contribution <span class="info-icon" title="Employer contributions do not reduce your taxable income or National Insurance, but they do count towards your annual pension allowance.">‚ÑπÔ∏è</span></label>
                    <div style="display: flex; gap: 10px; align-items: center; margin-bottom: 10px;">
                        <input type="radio" id="employerFixed" name="employerType" value="fixed" checked>
                        <label for="employerFixed" style="margin: 0;">Fixed Amount (¬£)</label>
                        <input type="radio" id="employerPercent" name="employerType" value="percent">
                        <label for="employerPercent" style="margin: 0;">Percentage (%)</label>
                    </div>
                    <input type="number" id="employerPension" value="0" min="0" step="100">
                    <input type="number" id="employerPensionPercent" value="0" min="0" max="100" step="0.1" style="display: none;">
                    <small style="color: #666;">Employer's contribution - not taxable to you but counts toward annual allowance</small>
                </div>

                <div class="form-group">
                    <label for="studentLoanPlan">Student Loan Plan</label>
                    <select id="studentLoanPlan">
                        <option value="none">No Student Loan</option>
                        <option value="plan1">Plan 1 (Before Sept 2012)</option>
                        <option value="plan2">Plan 2 (Sept 2012 onwards)</option>
                        <option value="plan4">Plan 4 (Scotland)</option>
                        <option value="plan5">Plan 5 (Sept 2023 onwards)</option>
                        <option value="postgrad">Postgraduate Loan</option>
                    </select>
                    <small style="color: #666;">Calculated automatically on gross salary (before salary sacrifice)</small>
                </div>

                <div class="checkbox-group">
                    <input type="checkbox" id="scotland">
                    <label for="scotland">I pay Scottish Income Tax</label>
                </div>

                <h3 class="section-title" style="margin-top: 30px;">Salary Sacrifice Schemes</h3>
                
                <div class="form-group">
                    <label for="cyclesToWork">Cycle to Work Scheme (¬£/year)</label>
                    <input type="number" id="cyclesToWork" value="0" min="0" step="50">
                    <small style="color: #666;">No official limit since 2019 - check your employer's scheme limit. Reduces taxable income.</small>
                </div>

                <div class="form-group">
                    <label for="additionalPension">Additional Pension Contributions</label>
                    <div style="display: flex; gap: 10px; align-items: center; margin-bottom: 10px;">
                        <input type="radio" id="additionalFixed" name="additionalType" value="fixed" checked>
                        <label for="additionalFixed" style="margin: 0;">Fixed Amount (¬£)</label>
                        <input type="radio" id="additionalPercent" name="additionalType" value="percent">
                        <label for="additionalPercent" style="margin: 0;">Percentage (%)</label>
                    </div>
                    <input type="number" id="additionalPension" value="0" min="0" step="100">
                    <input type="number" id="additionalPensionPercent" value="0" min="0" max="100" step="0.1" style="display: none;">
                    <small style="color: #666;">Salary sacrifice into workplace pension</small>
                </div>

                <div class="form-group">
                    <label for="carLeasing">Car Leasing Salary Sacrifice (¬£/year)</label>
                    <input type="number" id="carLeasing" value="0" min="0" step="500">
                    <small style="color: #666;">Annual lease cost - reduces taxable income, but you still pay BiK tax on car benefit</small>
                </div>

                <h3 class="section-title" style="margin-top: 30px;">Car Details (for BiK Calculation)</h3>
                
                <div class="form-group">
                    <label for="carValue">Car List Price (P11D Value) ¬£</label>
                    <input type="number" id="carValue" value="0" min="0" step="1000">
                    <small style="color: #666;">Only fill if you have a salary sacrifice car lease - used to calculate BiK tax</small>
                </div>

                <div class="two-column">
                    <div class="form-group">
                        <label for="carCO2">CO2 Emissions (g/km)</label>
                        <input type="number" id="carCO2" value="0" min="0" max="400" step="1">
                    </div>
                    <div class="form-group">
                        <label for="carType">Car Type</label>
                        <select id="carType">
                            <option value="none">No Company Car</option>
                            <option value="electric">Electric (BEV)</option>
                            <option value="hybrid">Plug-in Hybrid</option>
                            <option value="petrol">Petrol</option>
                            <option value="diesel">Diesel</option>
                        </select>
                    </div>
                </div>

                <div class="form-group" id="electricRangeGroup" style="display: none;">
                    <label for="electricRange">Electric Range (miles) - for hybrids</label>
                    <input type="number" id="electricRange" value="30" min="0" step="1">
                </div>
            </div>

            <div class="results-section">
                <h2 class="section-title">Your Results</h2>
                
                <div class="result-card">
                    <div class="result-main" id="takeHome">¬£30,000</div>
                    <div class="result-label">Annual Take-Home Pay</div>
                </div>

                <div class="result-card">
                    <div class="result-main" id="monthlyTakeHome" style="color: #3498db;">¬£2,500</div>
                    <div class="result-label">Monthly Take-Home Pay</div>
                </div>

                <div class="breakdown">
                    <h4 style="margin-bottom: 15px; color: #2c3e50;">Tax Breakdown</h4>
                    <div class="breakdown-item">
                        <span>Gross Salary:</span>
                        <span id="grossDisplay">¬£40,000</span>
                    </div>
                    <div class="breakdown-item">
                        <span>Personal Pension:</span>
                        <span id="pensionDisplay">¬£2,000</span>
                    </div>
                    <div class="breakdown-item">
                        <span>Employer Pension:</span>
                        <span id="employerPensionDisplay">¬£2,000</span>
                    </div>
                    <div class="breakdown-item">
                        <span>Total Pension Contributions:</span>
                        <span id="totalPensionDisplay">¬£4,000</span>
                    </div>
                    <div class="breakdown-item">
                        <span>Salary Sacrifice Total:</span>
                        <span id="sacrificeTotal">¬£0</span>
                    </div>
                    <div class="breakdown-item" id="studentLoanRow" style="display: none;">
                        <span>Student Loan Repayment:</span>
                        <span id="studentLoanPayment">¬£0</span>
                    </div>
                    <div class="breakdown-item">
                        <span>Taxable Income (after sacrifice):</span>
                        <span id="taxableIncome">¬£38,000</span>
                    </div>
                    <div class="breakdown-item">
                        <span>Income Tax:</span>
                        <span id="incomeTax">¬£5,086</span>
                    </div>
                    <div class="breakdown-item">
                        <span>National Insurance:</span>
                        <span id="nationalInsurance">¬£2,874</span>
                    </div>
                    <div class="breakdown-item" id="carBikRow" style="display: none;">
                        <span>Company Car BiK Tax:</span>
                        <span id="carBikTax">¬£0</span>
                    </div>
                    <div class="breakdown-item">
                        <span><strong>Net Take-Home:</strong></span>
                        <span id="netTakeHome"><strong>¬£30,040</strong></span>
                    </div>
                </div>

                <div class="car-section" id="carBreakdown" style="display: none;">
                    <h4 style="margin-bottom: 15px; color: #2c3e50;">Salary Sacrifice Car - BiK Tax Breakdown</h4>
                    <div style="background: #fff3cd; padding: 15px; border-radius: 8px; margin-bottom: 15px; font-size: 0.9rem;">
                        <strong>How it works:</strong> You salary sacrifice ¬£<span id="carLeasingDisplay">0</span>/year for car lease (pre-tax), 
                        but still pay BiK tax on the car's benefit value. Net result: significant tax savings!
                    </div>
                    <div class="bik-breakdown">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                            <span>Car List Price (P11D):</span>
                            <span id="carValueDisplay">¬£0</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                            <span>CO2 Emissions:</span>
                            <span id="carCO2Display">0g/km</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                            <span>BiK Rate:</span>
                            <span id="bikRateDisplay">0%</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; font-weight: bold; border-top: 1px solid #ccc; padding-top: 10px;">
                            <span>Annual BiK Value:</span>
                            <span id="bikValueDisplay">¬£0</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-top: 5px;">
                            <span>Your BiK Tax:</span>
                            <span id="bikTaxDisplay">¬£0</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-top: 10px; font-weight: bold; color: #27ae60; border-top: 1px solid #ccc; padding-top: 10px;">
                            <span>Net Monthly Car Cost:</span>
                            <span id="netCarCost">¬£0</span>
                        </div>
                    </div>
                </div>

                <div class="benefit-breakdown">
                    <h4 style="margin-bottom: 15px; color: #2c3e50;">Salary Sacrifice Benefit Analysis</h4>
                    <div class="benefit-item">
                        <span>Annual salary sacrifice cost:</span>
                        <span id="sacrificeCostDisplay" class="negative">¬£0</span>
                    </div>
                    <div class="benefit-item">
                        <span>Annual tax & NI savings:</span>
                        <span id="taxSavingsDisplay" style="color: #27ae60;">¬£0</span>
                    </div>
                    <div class="benefit-item">
                        <span><strong>Net annual benefit:</strong></span>
                        <span id="netBenefitDisplay"><strong>¬£0</strong></span>
                    </div>
                </div>

                <div class="savings-highlight">
                    <div class="savings-amount" id="totalSavings">¬£0</div>
                    <div style="font-size: 1.2rem; margin-bottom: 15px;">
                        <strong>Net Annual Benefit from Salary Sacrifice</strong>
                    </div>
                    <div style="font-size: 0.95rem; opacity: 0.9; line-height: 1.4;">
                        This is your <strong>net position improvement</strong> - the value of salary sacrifice schemes 
                        minus their cost, after accounting for all taxes and benefits.
                    </div>
                    <div style="margin-top: 15px; font-size: 0.9rem; opacity: 0.9;">
                        That's <span id="monthlySavings">¬£0</span> better off per month!
                    </div>
                </div>

                <div style="background: #f8f9fa; border-radius: 10px; padding: 20px; margin-top: 20px;">
                    <h4 style="margin-bottom: 15px; color: #2c3e50;">Scenario Comparison: How Your Benefit is Calculated</h4>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;" class="scenario-comparison">
                        <div style="background: #e8f5e8; border-radius: 8px; padding: 15px;" class="scenario-box">
                            <h5 style="color: #2c3e50; margin-bottom: 10px;">üìä Scenario A: With Salary Sacrifice</h5>
                            <div style="font-size: 0.85rem; line-height: 1.4;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                    <span>Gross Salary:</span>
                                    <span id="scenarioA_gross">¬£0</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                    <span>Less: Salary Sacrifice:</span>
                                    <span id="scenarioA_sacrifice" style="color: #e74c3c;">-¬£0</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                    <span>Less: Income Tax & NI:</span>
                                    <span id="scenarioA_taxes" style="color: #e74c3c;">-¬£0</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                    <span>Less: BiK Tax:</span>
                                    <span id="scenarioA_bik" style="color: #e74c3c;">-¬£0</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; font-weight: bold; border-top: 1px solid #ccc; padding-top: 5px;">
                                    <span>Final Take-Home:</span>
                                    <span id="scenarioA_final" style="color: #27ae60;">¬£0</span>
                                </div>
                            </div>
                        </div>

                        <div style="background: #fff3cd; border-radius: 8px; padding: 15px;" class="scenario-box">
                            <h5 style="color: #2c3e50; margin-bottom: 10px;">üìä Scenario B: Without Salary Sacrifice</h5>
                            <div style="font-size: 0.85rem; line-height: 1.4;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                    <span>Gross Salary:</span>
                                    <span id="scenarioB_gross">¬£0</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                    <span>Less: Income Tax & NI:</span>
                                    <span id="scenarioB_taxes" style="color: #e74c3c;">-¬£0</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                    <span>Take-home before purchases:</span>
                                    <span id="scenarioB_beforePurchases">¬£0</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                    <span>Less: Buy items after-tax:</span>
                                    <span id="scenarioB_purchases" style="color: #e74c3c;">-¬£0</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; font-weight: bold; border-top: 1px solid #ccc; padding-top: 5px;">
                                    <span>Final Position:</span>
                                    <span id="scenarioB_final" style="color: #f39c12;">¬£0</span>
                                </div>
                            </div>
                        </div>
                    </div> <div style="background: #d4edda; border: 1px solid #c3e6cb; border-radius: 8px; padding: 15px; text-align: center;">
                        <div style="font-size: 1.1rem; font-weight: bold; color: #155724; margin-bottom: 5px;">
                            üí∞ Your Annual Advantage: <span id="advantageAmount">¬£0</span>
                        </div>
                        <div style="font-size: 0.9rem; color: #155724;">
                            Scenario A (¬£<span id="advantageA">0</span>) minus Scenario B (¬£<span id="advantageB">0</span>) = Your net benefit
                        </div>
                    </div>

                    <div style="margin-top: 15px; font-size: 0.85rem; color: #666; font-style: italic;">
                        * Both scenarios assume the same pension contributions to focus purely on salary sacrifice benefits
                    </div>
                </div>
            </div>
        </div>

        <div class="disclaimer-section" style="background: #f8f9fa; border-top: 1px solid #e9ecef; border-bottom: 1px solid #e9ecef;">
            <div style="padding: 30px; max-width: 1400px; margin: 0 auto;">
                <h3 style="color: #2c3e50; margin-bottom: 20px; font-size: 1.2rem;">Important Disclaimer</h3>
                
                <div style="background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 8px; padding: 20px; margin-bottom: 20px;">
                    <strong>‚ö†Ô∏è This calculator is for guidance only</strong><br>
                    The results provided by this calculator are estimates based on the information you provide and current tax rates for 2025/26. Your actual tax liability and take-home pay may differ.
                </div>

                <div style="font-size: 0.9rem; line-height: 1.6; color: #555;">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px;">
                        <div>
                            <h4 style="color: #2c3e50; margin-bottom: 10px;">Tax & Financial Advice</h4>
                            <p>‚Ä¢ This calculator does not constitute financial or tax advice</p>
                            <p>‚Ä¢ Individual circumstances vary and may affect calculations</p>
                            <p>‚Ä¢ Tax rules and rates can change during the tax year</p>
                            <p>‚Ä¢ Always consult a qualified tax advisor or accountant for personalized advice</p>
                            <p>‚Ä¢ HMRC is the authoritative source for UK tax information</p>
                        </div>
                        
                        <div>
                            <h4 style="color: #2c3e50; margin-bottom: 10px;">Limitations & Accuracy</h4>
                            <p>‚Ä¢ Results are based on simplified calculations</p>
                            <p>‚Ä¢ Does not account for all possible tax reliefs or circumstances</p>
                            <p>‚Ä¢ Pension calculations may not reflect complex scheme rules</p>
                            <p>‚Ä¢ Student loan calculations assume standard repayment terms</p>
                            <p>‚Ä¢ No warranty is provided for accuracy or completeness</p>
                        </div>
                    </div>
                    
                    <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #ddd;">
                        <strong>Use at your own risk:</strong> While we strive for accuracy, we accept no responsibility for decisions made based on these calculations. For salary sacrifice schemes, always confirm details with your employer's HR department and seek professional advice before making financial commitments.
                    </div>
                    
                    <div style="margin-top: 15px; font-size: 0.85rem; color: #666;">
                        <p><strong>Data Privacy:</strong> This calculator runs entirely in your browser. No personal or financial information is transmitted to our servers or stored anywhere.</p>
                        <p><strong>Last Updated:</strong> Tax rates and thresholds for 2025/26 tax year. Check HMRC website for the most current information.</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="info-section">
            <div style="padding: 40px; max-width: 1400px; margin: 0 auto;">
                <h2 class="section-title">Important Information & Recommendations</h2>

                <div class="warning" id="pensionAllowanceWarning" style="display: none;">
                    <strong>‚ö†Ô∏è Pension Annual Allowance Alert</strong><br>
                    Your total pension contributions (¬£<span id="totalPensionAmount">0</span>) may exceed the annual allowance limits:
                    <ul style="margin: 10px 0 0 20px;">
                        <li>Standard allowance: ¬£60,000</li>
                        <li>Tapered allowance applies if income >¬£200,000</li>
                        <li>Money Purchase allowance: ¬£10,000 (if triggered)</li>
                    </ul>
                    <strong>Consider:</strong> Spreading contributions across tax years or seeking pension advice.
                </div>

                <div class="warning" id="highEarnerWarning" style="display: none;">
                    <strong>‚ö†Ô∏è High Earner Alert - "Childcare Tax Trap"</strong><br>
                    Your income is approaching or exceeds ¬£100,000. This creates a "cliff edge" where you lose:
                    <ul style="margin: 10px 0 0 20px;">
                        <li>Tax-Free Childcare (up to ¬£2,000/year per child)</li>
                        <li>30 hours free childcare (worth ~¬£9,400/year)</li>
                        <li>Your personal tax allowance starts reducing</li>
                    </ul>
                    <strong>Consider:</strong> Pension contributions to reduce adjusted net income below ¬£100,000.
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 30px; margin-top: 20px;">
                    <div class="info-box tax-free-childcare">
                        <strong>Tax-Free Childcare (Current Scheme):</strong><br>
                        Get up to ¬£2,000/year per child (¬£4,000 for disabled children). For every ¬£8 you pay in, the government adds ¬£2. This replaced childcare vouchers in 2018.
                        <br><br>
                        <strong>‚ö†Ô∏è Income Limit:</strong> You cannot get Tax-Free Childcare if you or your partner earn over ¬£100,000 adjusted net income per year.
                        <br><br>
                        <strong>Note:</strong> You cannot use Tax-Free Childcare if you're on Universal Credit - check which is better for your situation.
                    </div>

                    <div class="info-box">
                        <strong>2025/26 Pension Annual Allowance:</strong><br>
                        ‚Ä¢ Standard Annual Allowance: ¬£60,000<br>
                        ‚Ä¢ Money Purchase Annual Allowance: ¬£10,000 (if triggered)<br>
                        ‚Ä¢ Tapered allowance starts at ¬£200,000 income<br>
                        ‚Ä¢ Minimum tapered allowance: ¬£10,000<br>
                        <strong>Tip:</strong> Employer contributions count toward your annual allowance but don't reduce your taxable income.
                    </div>

                    <div class="tax-info">
                        <strong>2025/26 Tax Year Rates Applied:</strong><br>
                        ‚Ä¢ Personal Allowance: <span id="displayedPersonalAllowance">¬£12,570</span><br>
                        ‚Ä¢ Basic Rate: 20% (¬£12,571-¬£50,270)<br>
                        ‚Ä¢ Higher Rate: 40% (¬£50,271-¬£125,140)<br>
                        ‚Ä¢ Additional Rate: 45% (above ¬£125,140)<br>
                        ‚Ä¢ National Insurance: 8% (¬£12,571-¬£50,270), 2% (above ¬£50,270)<br>
                        ‚Ä¢ Company Car BiK rates: 3% (electric) to 37% (high CO2)<br>
                        <span id="personalAllowanceTaperingInfo" style="display: none;">‚Ä¢ Personal allowance reduces ¬£1 for every ¬£2 earned above ¬£100,000</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="share-section">
            <h3>Found this calculator helpful?</h3>
            <p>Help others discover these current tax savings by sharing this free tool!</p>
            <div class="share-buttons">
                <button class="share-btn" onclick="shareCalculator()">üì± Share Link</button>
                <button class="share-btn" onclick="downloadCalculator()">üíæ Download Tool</button>
                <a href="https://twitter.com/intent/tweet?text=Check out this free UK Tax %26 Salary Sacrifice Calculator 2025! üí∑ Calculate your savings with current BiK rates and salary sacrifice schemes." class="share-btn" target="_blank">üê¶ Tweet</a>
            </div>
        </div>
    </div>

    <div class="mobile-summary-fixed">
        <div class="mobile-summary-content">
            <div class="mobile-summary-item">
                <span class="mobile-summary-label">Yearly Take Home</span>
                <span class="mobile-summary-value" id="mobileSummaryYearly">¬£0</span>
            </div>
            <div class="mobile-summary-divider"></div>
            <div class="mobile-summary-item">
                <span class="mobile-summary-label">Monthly Take Home</span>
                <span class="mobile-summary-value" id="mobileSummaryMonthly">¬£0</span>
            </div>
        </div>
    </div>

    <div id="messageBoxOverlay" class="message-box-overlay">
        <div class="message-box-content">
            <h4 id="messageBoxTitle"></h4>
            <p id="messageBoxMessage"></p>
            <button id="messageBoxClose">OK</button>
        </div>
    </div>

    <script>
        // Constants for 2025/2026 tax year (subject to change by HMRC)
        const PERSONAL_ALLOWANCE = 12570;

        // England, Wales, and Northern Ireland Income Tax Bands 2025/26
        // These thresholds are for *taxable income* after Personal Allowance deduction.
        const ENGLAND_TAX_BANDS = [
            { upper_limit: 37700, rate: 0.20 },   // ¬£50,270 (Basic Rate Threshold) - ¬£12,570 (Personal Allowance) = ¬£37,700
            { upper_limit: 125139, rate: 0.40 }, // ¬£125,140 (Higher Rate Threshold) - ¬£1 (to match HMRC example's ¬£87,439 for 40% band)
            { upper_limit: Infinity, rate: 0.45 }
        ];

        // Scottish Income Tax Bands 2025/26 (assumed, as 2025 rates not yet published)
        // These thresholds are for *taxable income* after Personal Allowance deduction.
        const SCOTLAND_TAX_BANDS = [
            { upper_limit: 2306, rate: 0.19 },   // ¬£14,876 (Starter Rate Threshold) - ¬£12,570 (PA) = ¬£2,306
            { upper_limit: 13991, rate: 0.20 }, // ¬£26,561 (Basic Rate Threshold) - ¬£12,570 (PA) = ¬£13,991
            { upper_limit: 31092, rate: 0.21 }, // ¬£43,662 (Intermediate Rate Threshold) - ¬£12,570 (PA) = ¬£31,092
            { upper_limit: 62430, rate: 0.42 }, // ¬£75,000 (Higher Rate Threshold) - ¬£12,570 (PA) = ¬£62,430
            { upper_limit: 112570, rate: 0.45 }, // ¬£125,140 (Advanced Rate Threshold) - ¬£12,570 (PA) = ¬£112,570
            { upper_limit: Infinity, rate: 0.48 } // Top Rate
        ];

        // National Insurance 2025/26 (assumed, based on 2024/25 changes)
        const NI_PRIMARY_THRESHOLD = 12570; // Annual
        const NI_UPPER_EARNINGS_LIMIT = 50270; // Annual
        const NI_RATE_LOWER = 0.08; // Employee Class 1 (main rate, after April 2024 changes)
        const NI_RATE_HIGHER = 0.02; // Employee Class 1 (above UEL)

        // Student Loan Thresholds and Rates 2025/26 (assumed, based on 2024/25)
        const STUDENT_LOAN_THRESHOLDS = {
            'none': 0, // No threshold for 'none'
            'plan1': 24990,
            'plan2': 27295,
            'plan4': 31395,
            'plan5': 25000,
            'postgrad': 21000
        };
        const STUDENT_LOAN_RATE = 0.09; // 9% for Plans 1, 2, 4, 5
        const POSTGRAD_LOAN_RATE = 0.06; // 6% for Postgraduate Loan

        // BiK Rates 2025/26 (assumed, based on current projections)
        // Note: BiK rates are typically announced for several years ahead. These are estimates.
        const BIK_RATES_DATA = {
            'electric': 0.03, // 3% for BEVs for 2025/26 (increases 1% per year)
            'hybrid_electric_range': { // For 0-50g/km CO2 hybrids based on electric range
                130: 0.08, // 130+ miles electric range
                70: 0.11,  // 70-129 miles
                40: 0.14,  // 40-69 miles
                30: 0.17,  // 30-39 miles
                0: 0.20    // <30 miles (or 0 if not specified)
            },
            'petrol_co2_bands': [ // For petrol and hybrids >50g/km CO2
                { co2: 50, rate: 0.18 }, 
                { co2: 54, rate: 0.19 },
                { co2: 59, rate: 0.20 },
                { co2: 64, rate: 0.21 },
                { co2: 69, rate: 0.22 },
                { co2: 74, rate: 0.23 },
                { co2: 79, rate: 0.24 },
                { co2: 84, rate: 0.25 },
                { co2: 89, rate: 0.26 },
                { co2: 94, rate: 0.27 },
                { co2: 99, rate: 0.28 },
                { co2: 104, rate: 0.29 },
                { co2: 109, rate: 0.30 },
                { co2: 114, rate: 0.31 },
                { co2: 119, rate: 0.32 },
                { co2: 124, rate: 0.33 },
                { co2: 129, rate: 0.34 },
                { co2: 134, rate: 0.35 },
                { co2: 139, rate: 0.36 },
                { co2: 140, rate: 0.37 } // Max rate for higher CO2
            ],
            'diesel_supplement': 0.04, // 4% diesel supplement
            'max_bik_rate': 0.37 // HMRC max BiK rate for 2025/26
        };

        // Get DOM Elements
        const grossSalaryInput = document.getElementById('grossSalary');
        const pensionFixedRadio = document.getElementById('pensionFixed');
        const pensionPercentRadio = document.getElementById('pensionPercent');
        const pensionContribInput = document.getElementById('pensionContrib');
        const pensionContribPercentInput = document.getElementById('pensionContribPercent');

        const employerFixedRadio = document.getElementById('employerFixed');
        const employerPercentRadio = document.getElementById('employerPercent');
        const employerPensionInput = document.getElementById('employerPension');
        const employerPensionPercentInput = document.getElementById('employerPensionPercent');

        const studentLoanPlanSelect = document.getElementById('studentLoanPlan');
        const scotlandCheckbox = document.getElementById('scotland');
        const cyclesToWorkInput = document.getElementById('cyclesToWork');

        const additionalFixedRadio = document.getElementById('additionalFixed');
        const additionalPercentRadio = document.getElementById('additionalPercent');
        const additionalPensionInput = document.getElementById('additionalPension');
        const additionalPensionPercentInput = document.getElementById('additionalPensionPercent');

        const carLeasingInput = document.getElementById('carLeasing');
        const carValueInput = document.getElementById('carValue');
        const carCO2Input = document.getElementById('carCO2');
        const carTypeSelect = document.getElementById('carType');
        const electricRangeGroup = document.getElementById('electricRangeGroup');
        const electricRangeInput = document.getElementById('electricRange');

        // Output Elements
        const takeHomeDisplay = document.getElementById('takeHome');
        const monthlyTakeHomeDisplay = document.getElementById('monthlyTakeHome');
        const grossDisplay = document.getElementById('grossDisplay');
        const pensionDisplay = document.getElementById('pensionDisplay');
        const employerPensionDisplay = document.getElementById('employerPensionDisplay');
        const totalPensionDisplay = document.getElementById('totalPensionDisplay');
        const sacrificeTotalDisplay = document.getElementById('sacrificeTotal');
        const studentLoanRow = document.getElementById('studentLoanRow');
        const studentLoanPaymentDisplay = document.getElementById('studentLoanPayment');
        const taxableIncomeDisplay = document.getElementById('taxableIncome');
        const incomeTaxDisplay = document.getElementById('incomeTax');
        const nationalInsuranceDisplay = document.getElementById('nationalInsurance');
        const carBikRow = document.getElementById('carBikRow');
        const carBikTaxDisplay = document.getElementById('carBikTax');
        const netTakeHomeDisplay = document.getElementById('netTakeHome');
        const carBreakdownDiv = document.getElementById('carBreakdown');
        const carLeasingDisplay = document.getElementById('carLeasingDisplay');
        const carValueDisplay = document.getElementById('carValueDisplay');
        const carCO2Display = document.getElementById('carCO2Display');
        const bikRateDisplay = document.getElementById('bikRateDisplay');
        const bikValueDisplay = document.getElementById('bikValueDisplay');
        const bikTaxDisplay = document.getElementById('bikTaxDisplay');
        const netCarCostDisplay = document.getElementById('netCarCost');
        const sacrificeCostDisplay = document.getElementById('sacrificeCostDisplay');
        const taxSavingsDisplay = document.getElementById('taxSavingsDisplay');
        const netBenefitDisplay = document.getElementById('netBenefitDisplay');
        const totalSavingsDisplay = document.getElementById('totalSavings');
        const monthlySavingsDisplay = document.getElementById('monthlySavings');

        // Scenario Comparison
        const scenarioA_gross = document.getElementById('scenarioA_gross');
        const scenarioA_sacrifice = document.getElementById('scenarioA_sacrifice');
        const scenarioA_taxes = document.getElementById('scenarioA_taxes');
        const scenarioA_bik = document.getElementById('scenarioA_bik');
        const scenarioA_final = document.getElementById('scenarioA_final');

        const scenarioB_gross = document.getElementById('scenarioB_gross');
        const scenarioB_taxes = document.getElementById('scenarioB_taxes');
        const scenarioB_beforePurchases = document.getElementById('scenarioB_beforePurchases');
        const scenarioB_purchases = document.getElementById('scenarioB_purchases');
        const scenarioB_final = document.getElementById('scenarioB_final');

        const advantageAmount = document.getElementById('advantageAmount');
        const advantageA = document.getElementById('advantageA');
        const advantageB = document.getElementById('advantageB');

        // Mobile Fixed Summary
        const mobileSummaryYearly = document.getElementById('mobileSummaryYearly');
        const mobileSummaryMonthly = document.getElementById('mobileSummaryMonthly');

        // Message Box Elements
        const messageBoxOverlay = document.getElementById('messageBoxOverlay');
        const messageBoxTitle = document.getElementById('messageBoxTitle');
        const messageBoxMessage = document.getElementById('messageBoxMessage');
        const messageBoxClose = document.getElementById('messageBoxClose');
        
        // Tax Info display elements
        const displayedPersonalAllowance = document.getElementById('displayedPersonalAllowance');
        const personalAllowanceTaperingInfo = document.getElementById('personalAllowanceTaperingInfo');


        // Helper function to format currency
        function formatCurrency(amount) {
            return `¬£${Math.round(amount).toLocaleString(undefined, { minimumFractionDigits: 0, maximumFractionDigits: 0 })}`;
        }

        // Helper function to show custom message box
        function showMessageBox(title, message) {
            messageBoxTitle.textContent = title;
            messageBoxMessage.textContent = message;
            messageBoxOverlay.classList.add('show');
        }

        // Close message box
        messageBoxClose.addEventListener('click', () => {
            messageBoxOverlay.classList.remove('show');
        });

        // Helper function for percentage inputs
        function togglePercentageInput(fixedRadio, percentRadio, fixedInput, percentInput) {
            fixedRadio.addEventListener('change', () => {
                fixedInput.style.display = 'block';
                percentInput.style.display = 'none';
                calculateAll();
            });
            percentRadio.addEventListener('change', () => {
                fixedInput.style.display = 'none';
                percentInput.style.display = 'block';
                calculateAll();
            });
        }

        togglePercentageInput(pensionFixedRadio, pensionPercentRadio, pensionContribInput, pensionContribPercentInput);
        togglePercentageInput(employerFixedRadio, employerPercentRadio, employerPensionInput, employerPensionPercentInput);
        togglePercentageInput(additionalFixedRadio, additionalPercentRadio, additionalPensionInput, additionalPensionPercentInput);


        // Income Tax Calculation
        function calculateIncomeTax(grossIncome, isScotland) {
            let tax = 0;
            let incomeToTax = grossIncome;
            const bands = isScotland ? SCOTLAND_TAX_BANDS : ENGLAND_TAX_BANDS;

            // Calculate effective personal allowance
            let effectivePersonalAllowance = PERSONAL_ALLOWANCE;
            if (grossIncome > 100000) {
                effectivePersonalAllowance = Math.max(0, PERSONAL_ALLOWANCE - Math.floor((grossIncome - 100000) / 2));
            }

            // Deduct effective personal allowance from income to get taxable income
            incomeToTax = Math.max(0, incomeToTax - effectivePersonalAllowance);

            let remainingTaxableIncome = incomeToTax;
            let prevBandUpperLimit = 0; // Keep track of the upper limit of the previous band

            for (let i = 0; i < bands.length; i++) {
                const band = bands[i];
                const currentBandUpperLimit = band.upper_limit;

                // Calculate the portion of income that falls within the current band
                const amountInCurrentBand = Math.min(remainingTaxableIncome, currentBandUpperLimit - prevBandUpperLimit);

                if (amountInCurrentBand > 0) {
                    tax += amountInCurrentBand * band.rate;
                    remainingTaxableIncome -= amountInCurrentBand;
                }

                prevBandUpperLimit = currentBandUpperLimit; // Update for the next iteration

                if (remainingTaxableIncome <= 0) break; // No more income to tax
            }

            return Math.round(Math.max(0, tax));
        }

        // National Insurance Calculation
        function calculateNationalInsurance(niableIncome) {
            let ni = 0;
            const incomeAboveThreshold = Math.max(0, niableIncome - NI_PRIMARY_THRESHOLD);

            if (incomeAboveThreshold > 0) {
                const incomeInLowerBand = Math.min(incomeAboveThreshold, NI_UPPER_EARNINGS_LIMIT - NI_PRIMARY_THRESHOLD);
                ni += incomeInLowerBand * NI_RATE_LOWER;

                const incomeInHigherBand = Math.max(0, niableIncome - NI_UPPER_EARNINGS_LIMIT);
                ni += incomeInHigherBand * NI_RATE_HIGHER;
            }
            return Math.round(ni);
        }

        // Student Loan Calculation
        function calculateStudentLoan(grossSalary, planType) {
            if (planType === 'none' || !STUDENT_LOAN_THRESHOLDS[planType]) return 0;

            const threshold = STUDENT_LOAN_THRESHOLDS[planType];
            let rate = STUDENT_LOAN_RATE;
            if (planType === 'postgrad') {
                rate = POSTGRAD_LOAN_RATE;
            }

            const incomeAboveThreshold = Math.max(0, grossSalary - threshold);
            return Math.round(incomeAboveThreshold * rate);
        }

        // BiK (Benefit-in-Kind) Calculation
        function calculateBiK(carValue, carCO2, carType, electricRange, currentGrossSalary, isScotland) {
            let bikRate = 0;
            let annualBiKValue = 0;
            let bikTax = 0;

            if (carValue <= 0 || carType === 'none') {
                return { annualBiKValue: 0, bikTax: 0, bikRate: 0 };
            }

            if (carType === 'electric') {
                bikRate = BIK_RATES_DATA.electric;
            } else if (carType === 'hybrid') {
                if (carCO2 > 0 && carCO2 <= 50) { // Hybrids with CO2 <= 50g/km use electric range bands
                    const hybridBands = BIK_RATES_DATA.hybrid_electric_range;
                    if (electricRange >= 130) bikRate = hybridBands[130];
                    else if (electricRange >= 70) bikRate = hybridBands[70];
                    else if (electricRange >= 40) bikRate = hybridBands[40];
                    else if (electricRange >= 30) bikRate = hybridBands[30];
                    else bikRate = hybridBands[0]; // Default for <30 miles
                } else if (carCO2 > 50) { // Hybrids with CO2 > 50g/km use petrol CO2 bands
                    for (const band of BIK_RATES_DATA.petrol_co2_bands) {
                        if (carCO2 <= band.co2) {
                            bikRate = band.rate;
                            break;
                        }
                    }
                } else { // carCO2 is 0 for a hybrid, which is unusual for non-electric, treat as 0 BiK
                    return { annualBiKValue: 0, bikTax: 0, bikRate: 0 };
                }
            } else { // Petrol or Diesel
                if (carCO2 === 0) { // Petrol/Diesel with 0 CO2 should have 0 BiK
                    return { annualBiKValue: 0, bikTax: 0, bikRate: 0 };
                }
                for (const band of BIK_RATES_DATA.petrol_co2_bands) {
                    if (carCO2 <= band.co2) {
                        bikRate = band.rate;
                        break;
                    }
                }
                if (carType === 'diesel' && carCO2 > 0) { // Apply 4% diesel supplement
                    bikRate = Math.min(BIK_RATES_DATA.max_bik_rate, bikRate + BIK_RATES_DATA.diesel_supplement);
                }
            }

            annualBiKValue = carValue * bikRate;

            // Determine the marginal tax rate based on the current gross salary
            let marginalTaxRate = 0;
            const taxBands = isScotland ? SCOTLAND_TAX_BANDS : ENGLAND_TAX_BANDS;
            let tempGrossIncomeForMarginalRate = currentGrossSalary;

            // Adjust for personal allowance tapering to find effective taxable income for marginal rate
            let adjustedPersonalAllowance = PERSONAL_ALLOWANCE;
            if (tempGrossIncomeForMarginalRate > 100000) {
                const taperAmount = Math.floor((tempGrossIncomeForMarginalRate - 100000) / 2);
                adjustedPersonalAllowance = Math.max(0, PERSONAL_ALLOWANCE - taperAmount);
            }
            let tempTaxableIncomeForMarginalRate = Math.max(0, tempGrossIncomeForMarginalRate - adjustedPersonalAllowance);


            let prevMarginalBandUpperLimit = 0;
            for (let i = 0; i < taxBands.length; i++) {
                const band = taxBands[i];
                if (tempTaxableIncomeForMarginalRate > prevMarginalBandUpperLimit) {
                    marginalTaxRate = band.rate;
                }
                prevMarginalBandUpperLimit = band.upper_limit;
                if (tempTaxableIncomeForMarginalRate <= band.upper_limit) {
                    break; // Found the correct band
                }
            }
            
            bikTax = annualBiKValue * marginalTaxRate;

            return {
                annualBiKValue: Math.round(annualBiKValue),
                bikTax: Math.round(bikTax),
                bikRate: Math.round(bikRate * 1000) / 10 // Convert to percentage with one decimal
            };
        }


        // Main Calculation Function
        function calculateAll() {
            let grossSalary = parseFloat(grossSalaryInput.value) || 0;

            // Personal Pension Contribution
            let personalPensionContribution = 0;
            if (pensionFixedRadio.checked) {
                personalPensionContribution = parseFloat(pensionContribInput.value) || 0;
            } else {
                personalPensionContribution = grossSalary * (parseFloat(pensionContribPercentInput.value) / 100 || 0);
            }

            // Employer Pension Contribution (does NOT reduce taxable income, but counts for annual allowance)
            let employerPensionContribution = 0;
            if (employerFixedRadio.checked) {
                employerPensionContribution = parseFloat(employerPensionInput.value) || 0;
            } else {
                employerPensionContribution = grossSalary * (parseFloat(employerPensionPercentInput.value) / 100 || 0);
            }

            let cyclesToWork = parseFloat(cyclesToWorkInput.value) || 0;

            // Additional Pension Contributions (Salary Sacrifice)
            let additionalPensionSacrifice = 0;
            if (additionalFixedRadio.checked) {
                additionalPensionSacrifice = parseFloat(additionalPensionInput.value) || 0;
            } else {
                additionalPensionSacrifice = grossSalary * (parseFloat(additionalPensionPercentInput.value) / 100 || 0);
            }

            let carLeasing = parseFloat(carLeasingInput.value) || 0;
            let carValue = parseFloat(carValueInput.value) || 0;
            let carCO2 = parseFloat(carCO2Input.value) || 0;
            let carType = carTypeSelect.value;
            let electricRange = parseFloat(electricRangeInput.value) || 0;
            let studentLoanPlan = studentLoanPlanSelect.value;
            let isScotland = scotlandCheckbox.checked;

            // Show/hide electric range input for hybrids
            if (carType === 'hybrid') {
                electricRangeGroup.style.display = 'block';
            } else {
                electricRangeGroup.style.display = 'none';
            }

            // Total deductions that reduce gross salary for tax and NI purposes (including personal pension if it reduces taxable income)
            let totalPreTaxDeductions = personalPensionContribution + cyclesToWork + additionalPensionSacrifice + carLeasing;
            // Ensure deductions don't take gross below 0
            totalPreTaxDeductions = Math.min(totalPreTaxDeductions, grossSalary);

            // --- Scenario A: With Salary Sacrifice Calculations ---
            // Taxable income AFTER all pre-tax deductions
            let taxableIncomeA = grossSalary - totalPreTaxDeductions;
            
            let incomeTaxA = calculateIncomeTax(taxableIncomeA, isScotland);
            let nationalInsuranceA = calculateNationalInsurance(taxableIncomeA); // NI calculated on reduced income
            let studentLoanPaymentA = calculateStudentLoan(grossSalary, studentLoanPlan); // SL is usually on original gross
            
            // BiK tax is calculated on the P11D value and added to tax liability
            let bikResultA = calculateBiK(carValue, carCO2, carType, electricRange, grossSalary, isScotland);
            let carBikTaxA = bikResultA.bikTax;

            let netTakeHomeA = grossSalary - totalPreTaxDeductions - incomeTaxA - nationalInsuranceA - studentLoanPaymentA - carBikTaxA;


            // --- Scenario B: Without Salary Sacrifice Calculations ---
            // This calculates what take-home would be if all salary sacrifice items were paid post-tax
            let incomeTaxB = calculateIncomeTax(grossSalary, isScotland); // Tax on original gross
            let nationalInsuranceB = calculateNationalInsurance(grossSalary); // NI on original gross
            let studentLoanPaymentB = calculateStudentLoan(grossSalary, studentLoanPlan); // SL on original gross

            let netTakeHomeBeforePurchasesB = grossSalary - incomeTaxB - nationalInsuranceB - studentLoanPaymentB;

            // The "cost" of items without salary sacrifice is the full annual amount
            // This includes personal pension contribution here for comparison with Scenario A
            let postTaxPurchases = personalPensionContribution + cyclesToWork + additionalPensionSacrifice + carLeasing;
            let finalPositionB = netTakeHomeBeforePurchasesB - postTaxPurchases;


            // --- Display Results ---

            // Main Take-Home Displays
            takeHomeDisplay.textContent = formatCurrency(netTakeHomeA);
            monthlyTakeHomeDisplay.textContent = formatCurrency(netTakeHomeA / 12);
            mobileSummaryYearly.textContent = formatCurrency(netTakeHomeA);
            mobileSummaryMonthly.textContent = formatCurrency(netTakeHomeA / 12);


            // Tax Breakdown
            grossDisplay.textContent = formatCurrency(grossSalary);
            pensionDisplay.textContent = formatCurrency(personalPensionContribution);
            employerPensionDisplay.textContent = formatCurrency(employerPensionContribution);
            totalPensionDisplay.textContent = formatCurrency(personalPensionContribution + employerPensionContribution + additionalPensionSacrifice);
            sacrificeTotalDisplay.textContent = formatCurrency(totalPreTaxDeductions); // Now includes personal pension
            taxableIncomeDisplay.textContent = formatCurrency(taxableIncomeA);
            incomeTaxDisplay.textContent = formatCurrency(incomeTaxA);
            nationalInsuranceDisplay.textContent = formatCurrency(nationalInsuranceA);

            if (studentLoanPlan !== 'none' && studentLoanPaymentA > 0) {
                studentLoanRow.style.display = 'flex';
                studentLoanPaymentDisplay.textContent = formatCurrency(studentLoanPaymentA);
            } else {
                studentLoanRow.style.display = 'none';
            }

            if (carLeasing > 0 && carValue > 0 && carType !== 'none') {
                carBikRow.style.display = 'flex';
                carBikTaxDisplay.textContent = formatCurrency(carBikTaxA);
            } else {
                carBikRow.style.display = 'none';
            }
            netTakeHomeDisplay.textContent = formatCurrency(netTakeHomeA);


            // Car Breakdown
            if (carLeasing > 0 && carValue > 0 && carType !== 'none') {
                carBreakdownDiv.style.display = 'block';
                carLeasingDisplay.textContent = formatCurrency(carLeasing);
                carValueDisplay.textContent = formatCurrency(carValue);
                carCO2Display.textContent = `${carCO2}g/km`;
                bikRateDisplay.textContent = `${bikResultA.bikRate}%`;
                bikValueDisplay.textContent = formatCurrency(bikResultA.annualBiKValue);
                bikTaxDisplay.textContent = formatCurrency(bikResultA.bikTax);
                
                const netMonthlyCarCost = (carLeasing + carBikTaxA) / 12;
                netCarCostDisplay.textContent = formatCurrency(netMonthlyCarCost);

            } else {
                carBreakdownDiv.style.display = 'none';
            }


            // Salary Sacrifice Benefit Analysis
            sacrificeCostDisplay.textContent = formatCurrency(totalPreTaxDeductions); // Now includes personal pension
            
            // Tax savings are the difference in total tax/NI/SL between 'without SS' and 'with SS' scenarios
            const taxSavings = (incomeTaxB + nationalInsuranceB + studentLoanPaymentB) - (incomeTaxA + nationalInsuranceA + studentLoanPaymentA);
            taxSavingsDisplay.textContent = formatCurrency(taxSavings);
            taxSavingsDisplay.style.color = taxSavings >= 0 ? '#27ae60' : '#e74c3c'; // Green for savings, red for loss

            // Net annual benefit calculation: Difference in final take-home between scenarios
            let netAnnualBenefit = netTakeHomeA - finalPositionB;
            netBenefitDisplay.textContent = formatCurrency(netAnnualBenefit);
            netBenefitDisplay.style.color = netAnnualBenefit >= 0 ? '#27ae60' : '#e74c3c';

            totalSavingsDisplay.textContent = formatCurrency(netAnnualBenefit);
            totalSavingsDisplay.style.background = netAnnualBenefit >= 0 ? 'linear-gradient(135deg, #27ae60, #2ecc71)' : 'linear-gradient(135deg, #e74c3c, #c0392b)';
            monthlySavingsDisplay.textContent = formatCurrency(netAnnualBenefit / 12);


            // Scenario Comparison
            scenarioA_gross.textContent = formatCurrency(grossSalary);
            scenarioA_sacrifice.textContent = formatCurrency(totalPreTaxDeductions); // Now includes personal pension
            scenarioA_taxes.textContent = formatCurrency(incomeTaxA + nationalInsuranceA + studentLoanPaymentA);
            scenarioA_bik.textContent = formatCurrency(carBikTaxA);
            scenarioA_final.textContent = formatCurrency(netTakeHomeA);

            scenarioB_gross.textContent = formatCurrency(grossSalary);
            scenarioB_taxes.textContent = formatCurrency(incomeTaxB + nationalInsuranceB + studentLoanPaymentB);
            scenarioB_beforePurchases.textContent = formatCurrency(netTakeHomeBeforePurchasesB);
            scenarioB_purchases.textContent = formatCurrency(postTaxPurchases); // Now includes personal pension
            scenarioB_final.textContent = formatCurrency(finalPositionB);

            // Advantage summary
            advantageAmount.textContent = formatCurrency(netAnnualBenefit);
            advantageA.textContent = Math.round(netTakeHomeA).toLocaleString();
            advantageB.textContent = Math.round(finalPositionB).toLocaleString();

            // Pension Allowance Warning
            const totalPensionContributions = personalPensionContribution + employerPensionContribution + additionalPensionSacrifice;
            const adjustedIncomeForPensionAllowance = grossSalary + employerPensionContribution; // Adjusted income for AA tapering calculation
            const taperedAllowance = calculateTaperedAllowance(adjustedIncomeForPensionAllowance);
            
            const pensionWarning = document.getElementById('pensionAllowanceWarning');
            document.getElementById('totalPensionAmount').textContent = totalPensionContributions.toLocaleString();
            
            if (totalPensionContributions > taperedAllowance) {
                pensionWarning.style.display = 'block';
            } else {
                pensionWarning.style.display = 'none';
            }

            // High Earner Warning (Childcare Tax Trap)
            const adjustedNetIncomeForChildcare = grossSalary - personalPensionContribution - additionalPensionSacrifice;
            const highEarnerWarning = document.getElementById('highEarnerWarning');
            if (adjustedNetIncomeForChildcare >= 95000 && adjustedNetIncomeForChildcare < 100000) { // Warning if approaching 100k
                highEarnerWarning.style.display = 'block';
                highEarnerWarning.querySelector('strong').textContent = '‚ö†Ô∏è High Earner Alert - "Childcare Tax Trap"';
                highEarnerWarning.querySelector('ul').innerHTML = `
                    <li>Tax-Free Childcare (up to ¬£2,000/year per child)</li>
                    <li>30 hours free childcare (worth ~¬£9,400/year)</li>
                    <li>Your personal tax allowance starts reducing</li>
                `;
            } else if (adjustedNetIncomeForChildcare >= 100000) { // More direct warning if over 100k
                 highEarnerWarning.style.display = 'block';
                 highEarnerWarning.querySelector('strong').textContent = '‚ö†Ô∏è High Earner Alert - "Childcare Tax Trap" & Personal Allowance Loss';
                 highEarnerWarning.querySelector('ul').innerHTML = `
                    <li>Tax-Free Childcare (up to ¬£2,000/year per child)</li>
                    <li>30 hours free childcare (worth ~¬£9,400/year)</li>
                    <li>Your personal tax allowance is reducing</li>
                 `;
            }
            else {
                highEarnerWarning.style.display = 'none';
            }

            // Update Personal Allowance in Tax Info section
            let effectivePersonalAllowanceForDisplay = PERSONAL_ALLOWANCE;
            if (grossSalary > 100000) {
                effectivePersonalAllowanceForDisplay = Math.max(0, PERSONAL_ALLOWANCE - Math.floor((grossSalary - 100000) / 2));
            }
            displayedPersonalAllowance.textContent = formatCurrency(effectivePersonalAllowanceForDisplay);
            
            if (grossSalary > 100000) {
                personalAllowanceTaperingInfo.style.display = 'block';
            } else {
                personalAllowanceTaperingInfo.style.display = 'none';
            }
        }

        // Pension allowance limits for 2025/26 (moved here for scope)
        const PENSION_LIMITS = {
            annualAllowance: 60000,
            taperedThreshold: 200000,
            minimumAllowance: 10000
        };

        function calculateTaperedAllowance(adjustedIncome) {
            if (adjustedIncome <= PENSION_LIMITS.taperedThreshold) {
                return PENSION_LIMITS.annualAllowance;
            }
            
            const reduction = (adjustedIncome - PENSION_LIMITS.taperedThreshold) / 2;
            const taperedAllowance = PENSION_LIMITS.annualAllowance - reduction;
            
            return Math.max(taperedAllowance, PENSION_LIMITS.minimumAllowance);
        }

        function shareCalculator() {
            if (navigator.share) {
                navigator.share({
                    title: 'UK Tax & Salary Sacrifice Calculator 2025',
                    text: 'Check out this free calculator with current BiK rates and salary sacrifice schemes!',
                    url: window.location.href
                }).catch((error) => {
                    // User cancelled share or error occurred
                    if (error.name !== 'AbortError') {
                        showMessageBox('Share Error', 'Could not share the link. Please try copying it manually.');
                    }
                });
            } else {
                navigator.clipboard.writeText(window.location.href)
                    .then(() => showMessageBox('Link Copied!', 'The calculator link has been copied to your clipboard.'))
                    .catch(() => showMessageBox('Copy Error', 'Could not copy the link to clipboard. Please copy it manually.'));
            }
        }

        function downloadCalculator() {
            const element = document.createElement('a');
            const file = new Blob([document.documentElement.outerHTML], {type: 'text/html'});
            element.href = URL.createObjectURL(file);
            element.download = 'uk-tax-calculator-2025.html';
            document.body.appendChild(element);
            element.click();
            document.body.removeChild(element);
            showMessageBox('Download Complete!', 'The calculator HTML file has been downloaded.');
        }

        function toggleElectricRange() {
            const carType = document.getElementById('carType').value;
            const electricRangeGroup = document.getElementById('electricRangeGroup');
            
            if (carType === 'hybrid') {
                electricRangeGroup.style.display = 'block';
            } else {
                electricRangeGroup.style.display = 'none';
            }
        }

        // Add event listeners
        document.querySelectorAll('input, select').forEach(input => {
            input.addEventListener('input', calculateAll);
            input.addEventListener('change', calculateAll);
        });

        document.getElementById('carType').addEventListener('change', function() {
            toggleElectricRange();
            calculateAll();
        });

        // Initial setup on page load
        toggleElectricRange(); // Set initial state of electric range input
        calculateAll(); // Perform initial calculation
    </script>
</body>
</html>
